<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="study">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="js/jquery-1.11.3.min.js"></script>
    <title>Study</title>

  </head>
  <body>
    <div id="dashnavdiv">demographics <button onclick="responsesCSV()">download responses</button></div>
    </br></hr>
    <div id="uberdiv">
      <!-- Would be nice to show hits/activity here? Or something? -->
      <script>
	function responsesCSV(){

	var responses = <%- JSON.stringify(responseobj) %>;
	var responses = responses.map(JSON.parse);

	if(!responses||responses.length==0){
	alert("No responses in database");
	return;
	}
	
	let csvContent="data:text/csv;charset=utf-8,";
	csvContent+=responses[0].csvHeaders.join(",")+"\r\n";
	responses.forEach(function(response){
	var hm_values = response.csvHeaders.length;
	for(var i=0;i<hm_values;i++){
	    csvContent+=response[response.csvHeaders[i]];
	    if(i < hm_values-1){
		csvContent+=",";
	    }else{
		csvContent+="\r\n";
	    }
	}
		   });//for each response
   var encodedUri = encodeURI(csvContent);
   var link = document.createElement("a");
   link.setAttribute("href", encodedUri);
   link.setAttribute("download", "my_data.csv");
   document.body.appendChild(link); // Required for FF
   link.click();
}
	
      </script>
	  
    </div>
  </body>
</html>
